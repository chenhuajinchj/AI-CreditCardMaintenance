<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>信用卡智囊 (V5.5 仪表盘)</title>
    <link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- 图表库：Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>

    <!-- Toast 容器 -->
    <div class="toast-container" id="toast-container"></div>

    <div id="page-auth">
        <div class="auth-card">
            <div class="auth-title">信用卡智囊</div>
            <div class="auth-subtitle">登录以同步您的卡片与流水数据</div>
            <label>邮箱</label>
            <input type="email" id="login-email" placeholder="you@example.com">
            <label>密码</label>
            <input type="password" id="login-password" placeholder="至少 6 位">
            <div class="auth-actions">
                <button id="btn-login" class="btn btn-outline" style="width:50%;">登录</button>
                <button id="btn-register" class="btn" style="width:50%;">注册</button>
            </div>
        </div>
    </div>


    <div id="page-home" class="page container">
        <h2 style="margin-bottom:20px;">资产概览</h2>
        <div style="display:flex;justify-content:flex-end;margin:8px 0;">
            <button class="btn" id="toggleChartBtn">查看趋势</button>
        </div>
        <div id="chartCard" style="display:none;">
            <div class="dashboard-card chart-card">
                <canvas id="spendChart"></canvas>
            </div>
        </div>
        <div id="card-dashboard"></div>
        <div style="height:50px;"></div> </div>

    <div id="page-records" class="page container">
        <h2>账单流水</h2>
        <div id="records-summary-view">
            <div id="rec-card-list"></div>
        </div>
    <div id="records-detail-view" style="display:none;">
        <div class="dashboard-card" style="margin-bottom:12px;">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div>
                    <div style="font-weight:700;" id="record-detail-title"></div>
                    <div style="font-size:12px; color:var(--sub-text);">账期内流水（倒序）</div>
                </div>
                <button class="btn btn-outline" id="btn-record-back" style="width:auto; padding:8px 12px;">返回</button>
            </div>
        </div>
        <div id="record-detail-list"></div>
        <div class="fab-detail" id="fab-detail-add">+</div>
    </div>
        <div class="fab" id="fab-add-record">
            <svg class="icon icon-24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14M5 12h14" />
            </svg>
        </div>
    </div>

    <div id="page-settings" class="page container">
        <h2>设置</h2>
        <div class="dashboard-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span>深色模式</span>
                <input type="checkbox" id="dark-switch" style="width:auto; transform:scale(1.5);">
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:15px 0; opacity:0.1;">
            <button id="btn-export" class="btn btn-outline">备份数据</button>
            <button id="btn-clear" class="btn btn-danger">清空重置</button>
            <button id="btn-logout" class="btn btn-outline" style="margin-top:12px;">退出登录</button>
            <div style="margin-top:18px;">
                <div style="font-weight:600; margin-bottom:8px;">费率预设</div>
                <input type="text" id="preset-name" placeholder="预设名称（如 某平台）">
                <input type="text" id="preset-merchant" placeholder="商户名称">
                <input type="number" id="preset-rate" placeholder="费率%" step="0.01">
                <button class="btn btn-outline" id="btn-add-preset">新增预设</button>
                <div id="preset-list" style="margin-top:10px;"></div>
            </div>
            <div class="sync-status-mini" id="sync-status-mini">
                <span class="sync-status-mini-dot" id="sync-status-mini-dot"></span>
                <span id="sync-status-mini-text">已连接</span>
            </div>
        </div>
    </div>

    <div id="page-add-card" class="page container">
        <h2>新卡片</h2>
        <div class="dashboard-card">
            <label>名称</label><input type="text" id="c-name" placeholder="例如：招商Young">
            <label>额度</label><input type="number" id="c-limit" placeholder="50000">
            <label>账单日</label><input type="number" id="c-bill" placeholder="每月几号出账">
            <label>当前已用额度/欠款</label><input type="number" id="c-current-used" placeholder="0">
            <label>卡号后4位（选填）</label><input type="text" id="c-tail" placeholder="8888" maxlength="4" pattern="[0-9]*">
            <button id="btn-add-card" class="btn">保存</button>
            <button class="btn btn-outline nav-btn" data-nav="home">返回</button>
        </div>
    </div>

        <div id="page-add-rec" class="page container">
        <h2>记一笔</h2>
        <div class="dashboard-card">
            <label>选择卡片</label><select id="r-card"></select>
            <label>日期</label><input type="date" id="r-date">
            <label>金额</label><input type="number" id="r-amt">
            <label>类型</label>
            <div class="type-group">
                <label class="type-option">
                    <input type="radio" name="r-type" value="消费" checked> 消费
                </label>
                <label class="type-option">
                    <input type="radio" name="r-type" value="还款"> 还款
                </label>
                <label class="type-option">
                    <input type="radio" name="r-type" value="退款"> 退款
                </label>
            </div>
            <div id="fee-section">
                <label>支付方式</label>
                <select id="r-channel">
                    <option value="刷卡">刷卡</option>
                    <option value="支付宝">支付宝</option>
                    <option value="微信">微信</option>
                    <option value="京东">京东</option>
                    <option value="其它">其它</option>
                </select>
                <label>费率预设</label>
                <select id="r-preset"></select>
                <div id="fee-group" style="display:flex; gap:10px;">
                    <div style="flex:1"><label>费率%</label><input type="number" id="r-rate" value="0.60"></div>
                    <div style="flex:1"><label>手续费</label><input type="text" id="r-fee" disabled style="color:red"></div>
                </div>
                <div id="merchant-group"><label>商户</label><input type="text" id="r-merch"></div>
                <div id="refund-section">
                    <label>关联消费（退款时选）</label>
                    <select id="r-refund-src"></select>
                </div>
            </div>
            <button id="btn-add-rec" class="btn">确认</button>
            <button class="btn btn-outline nav-btn" data-nav="records">返回</button>
        </div>
    </div>

    <div id="rec-modal" class="rec-modal hidden">
        <div class="rec-modal-backdrop"></div>
        <div class="rec-modal-panel">
            <div class="rec-modal-header">
                <div>
                    <div class="rec-modal-title" id="rec-modal-title">流水</div>
                    <div style="font-size:12px; color:var(--sub-text);">本期流水明细</div>
                </div>
                <button class="rec-modal-close">✕</button>
            </div>
            <div class="rec-modal-filters">
                <select id="rec-type-filter">
                    <option value="ALL">全部</option>
                    <option value="消费">消费</option>
                    <option value="还款">还款</option>
                    <option value="退款">退款</option>
                </select>
            </div>
            <div id="rec-modal-list"></div>
        </div>
    </div>

    <div class="tab-bar" id="tab-bar" style="display:none;">
        <div class="tab-item" data-page="home">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 20h16" />
                <rect x="6" y="10" width="3.2" height="9.5" rx="1" />
                <rect x="10.9" y="6" width="3.2" height="13.5" rx="1" />
                <rect x="15.8" y="12" width="3.2" height="7.5" rx="1" />
            </svg>
            概览
        </div>
        <div class="tab-item" data-page="add-card">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3.5" y="6" width="17" height="12" rx="2.5" />
                <path d="M6 11h12" />
                <path d="M7 14h3" />
            </svg>
            办卡
        </div>
        <div class="tab-item" data-page="records">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M7 4.5h8.5L19.5 8V19a1.5 1.5 0 0 1-1.5 1.5H7A1.5 1.5 0 0 1 5.5 19V6a1.5 1.5 0 0 1 1.5-1.5Z"/>
                <path d="M15.5 4.5V8H19" />
                <path d="M8.5 12h7" />
                <path d="M8.5 15.5h5" />
            </svg>
            流水
        </div>
        <div class="tab-item" data-page="settings">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" />
                <path d="M19.4 13.5a7.6 7.6 0 0 0 0-3l2-1.6-2-3.5-2.5 1a7.6 7.6 0 0 0-2.6-1.5L14 1.5h-4l-.3 3.4a7.6 7.6 0 0 0-2.6 1.5l-2.5-1-2 3.5 2 1.6a7.6 7.6 0 0 0 0 3L.6 15.1l2 3.5 2.5-1a7.6 7.6 0 0 0 2.6 1.5l.3 3.4h4l.3-3.4a7.6 7.6 0 0 0 2.6-1.5l2.5 1 2-3.5Z" />
            </svg>
            设置
        </div>
    </div>

    <script type="module" src="./app.js"></script>
</body>
</html>
